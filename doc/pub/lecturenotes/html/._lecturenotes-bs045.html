<!--
HTML file automatically generated from DocOnce source
(https://github.com/doconce/doconce/)
doconce format html lecturenotes.do.txt --html_style=bootstrap --pygments_html_style=default --html_admon=bootstrap_panel --html_output=lecturenotes-bs --no_mako
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/doconce/doconce/" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Using Machine Learning to Classify Phase Transitions">
<title>Using Machine Learning to Classify Phase Transitions</title>
<!-- Bootstrap style: bootstrap -->
<!-- doconce format html lecturenotes.do.txt --html_style=bootstrap --pygments_html_style=default --html_admon=bootstrap_panel --html_output=lecturenotes-bs --no_mako -->
<link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->
<style type="text/css">
/* Add scrollbar to dropdown menus in bootstrap navigation bar */
.dropdown-menu {
   height: auto;
   max-height: 400px;
   overflow-x: hidden;
}
/* Adds an invisible element before each target to offset for the navigation
   bar */
.anchor::before {
  content:"";
  display:block;
  height:50px;      /* fixed header height for style bootstrap */
  margin:-50px 0 0; /* negative fixed header height */
}
</style>
</head>

<!-- tocinfo
{'highest level': 2,
 'sections': [('What is this about?', 2, None, 'what-is-this-about'),
              ('Where do I find the material?',
               2,
               None,
               'where-do-i-find-the-material'),
              ('AI/ML and some statements you may have heard (and what do they '
               'mean?)',
               2,
               None,
               'ai-ml-and-some-statements-you-may-have-heard-and-what-do-they-mean'),
              ('Types of machine learning',
               2,
               None,
               'types-of-machine-learning'),
              ('Main categories', 2, None, 'main-categories'),
              ('The plethora  of machine learning algorithms/methods',
               2,
               None,
               'the-plethora-of-machine-learning-algorithms-methods'),
              ('Example of generative modeling, "taken from Generative Deep '
               'Learning by David '
               'Foster":"https://www.oreilly.com/library/view/generative-deep-learning/9781098134174/ch01.html"',
               2,
               None,
               'example-of-generative-modeling-taken-from-generative-deep-learning-by-david-foster-https-www-oreilly-com-library-view-generative-deep-learning-9781098134174-ch01-html'),
              ('Example of discriminative modeling, "taken from Generative '
               'Deeep Learning by David '
               'Foster":"https://www.oreilly.com/library/view/generative-deep-learning/9781098134174/ch01.html"',
               2,
               None,
               'example-of-discriminative-modeling-taken-from-generative-deeep-learning-by-david-foster-https-www-oreilly-com-library-view-generative-deep-learning-9781098134174-ch01-html'),
              ('Taxonomy of generative deep learning, "taken from Generative '
               'Deep Learning by David '
               'Foster":"https://www.oreilly.com/library/view/generative-deep-learning/9781098134174/ch01.html"',
               2,
               None,
               'taxonomy-of-generative-deep-learning-taken-from-generative-deep-learning-by-david-foster-https-www-oreilly-com-library-view-generative-deep-learning-9781098134174-ch01-html'),
              ('Good books with hands-on material and codes',
               2,
               None,
               'good-books-with-hands-on-material-and-codes'),
              ('What are the basic Machine Learning ingredients?',
               2,
               None,
               'what-are-the-basic-machine-learning-ingredients'),
              ('Low-level machine learning, the family of ordinary least '
               'squares methods',
               2,
               None,
               'low-level-machine-learning-the-family-of-ordinary-least-squares-methods'),
              ('Setting up the equations', 2, None, 'setting-up-the-equations'),
              ('The objective/cost/loss function',
               2,
               None,
               'the-objective-cost-loss-function'),
              ('Training solution', 2, None, 'training-solution'),
              ('Selected references', 2, None, 'selected-references'),
              ('Machine learning. A simple perspective on the interface '
               'between ML and Physics',
               2,
               None,
               'machine-learning-a-simple-perspective-on-the-interface-between-ml-and-physics'),
              ('ML in Nuclear  Physics (or any field in physics)',
               2,
               None,
               'ml-in-nuclear-physics-or-any-field-in-physics'),
              ('Phase Transitions and Critical Phenomena',
               2,
               None,
               'phase-transitions-and-critical-phenomena'),
              ('Phase Transitions: Definitions',
               2,
               None,
               'phase-transitions-definitions'),
              ('Order Parameter and Symmetry Breaking',
               2,
               None,
               'order-parameter-and-symmetry-breaking'),
              ('Phase Transitions: Overview',
               2,
               None,
               'phase-transitions-overview'),
              ('Phase Transitions: First vs Second Order',
               2,
               None,
               'phase-transitions-first-vs-second-order'),
              ('Critical Phenomena and Scaling',
               2,
               None,
               'critical-phenomena-and-scaling'),
              ('2D Ising Model: Definition',
               2,
               None,
               '2d-ising-model-definition'),
              ('2D Ising Model: Critical Temperature',
               2,
               None,
               '2d-ising-model-critical-temperature'),
              ('q-State Potts Model: Definition',
               2,
               None,
               'q-state-potts-model-definition'),
              ('2D Potts Model: Phase Behavior',
               2,
               None,
               '2d-potts-model-phase-behavior'),
              ('Monte Carlo Sampling of Spin Models',
               2,
               None,
               'monte-carlo-sampling-of-spin-models'),
              ('Metropolis Algorithm', 2, None, 'metropolis-algorithm'),
              ('Metropolis Algorithm (Pseudo-code)',
               2,
               None,
               'metropolis-algorithm-pseudo-code'),
              ('Simple code to generate images',
               2,
               None,
               'simple-code-to-generate-images'),
              ('Monte Carlo Data for ML', 2, None, 'monte-carlo-data-for-ml'),
              ('Principal Component Analysis (PCA) Basics',
               2,
               None,
               'principal-component-analysis-pca-basics'),
              ('PCA for Phase Identification',
               2,
               None,
               'pca-for-phase-identification'),
              ('PCA Workflow for Spin Data',
               2,
               None,
               'pca-workflow-for-spin-data'),
              ('PCA Example: Ising Model', 2, None, 'pca-example-ising-model'),
              ('PCA Limitations', 2, None, 'pca-limitations'),
              ('Convolutional Neural Networks (CNNs)',
               2,
               None,
               'convolutional-neural-networks-cnns'),
              ('CNN for Phase Classification',
               2,
               None,
               'cnn-for-phase-classification'),
              ('Example CNN Architecture', 2, None, 'example-cnn-architecture'),
              ('CNN: Training and Results',
               2,
               None,
               'cnn-training-and-results'),
              ('CNN Interpretability', 2, None, 'cnn-interpretability'),
              ('CNN (PyTorch) Code Example',
               2,
               None,
               'cnn-pytorch-code-example'),
              ('Code to read in Ising data',
               2,
               None,
               'code-to-read-in-ising-data'),
              ('Variational Autoencoders (VAE) Overview',
               2,
               None,
               'variational-autoencoders-vae-overview'),
              ('VAE for Spin Configurations',
               2,
               None,
               'vae-for-spin-configurations'),
              ('VAE Architecture Details', 2, None, 'vae-architecture-details'),
              ('VAE Results on Ising Model',
               2,
               None,
               'vae-results-on-ising-model'),
              ('VAE: Generation and Interpretation',
               2,
               None,
               'vae-generation-and-interpretation'),
              ('VAE (PyTorch) Code Example',
               2,
               None,
               'vae-pytorch-code-example'),
              ('Supervised vs Unsupervised Methods',
               2,
               None,
               'supervised-vs-unsupervised-methods'),
              ('Method Interpretability and Features',
               2,
               None,
               'method-interpretability-and-features'),
              ('Performance and Use Cases',
               2,
               None,
               'performance-and-use-cases'),
              ('Summary of Methods', 2, None, 'summary-of-methods'),
              ('Conclusions', 2, None, 'conclusions'),
              ('References', 2, None, 'references')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript" async
 src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="ecturenotes-bs.html">Using Machine Learning to Classify Phase Transitions</a>
  </div>
  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs001.html#what-is-this-about" style="font-size: 80%;">What is this about?</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs002.html#where-do-i-find-the-material" style="font-size: 80%;">Where do I find the material?</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs003.html#ai-ml-and-some-statements-you-may-have-heard-and-what-do-they-mean" style="font-size: 80%;">AI/ML and some statements you may have heard (and what do they mean?)</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs004.html#types-of-machine-learning" style="font-size: 80%;">Types of machine learning</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs005.html#main-categories" style="font-size: 80%;">Main categories</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs006.html#the-plethora-of-machine-learning-algorithms-methods" style="font-size: 80%;">The plethora  of machine learning algorithms/methods</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs007.html#example-of-generative-modeling-taken-from-generative-deep-learning-by-david-foster-https-www-oreilly-com-library-view-generative-deep-learning-9781098134174-ch01-html" style="font-size: 80%;">Example of generative modeling, "taken from Generative Deep Learning by David Foster":"https://www.oreilly.com/library/view/generative-deep-learning/9781098134174/ch01.html"</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs008.html#example-of-discriminative-modeling-taken-from-generative-deeep-learning-by-david-foster-https-www-oreilly-com-library-view-generative-deep-learning-9781098134174-ch01-html" style="font-size: 80%;">Example of discriminative modeling, "taken from Generative Deeep Learning by David Foster":"https://www.oreilly.com/library/view/generative-deep-learning/9781098134174/ch01.html"</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs009.html#taxonomy-of-generative-deep-learning-taken-from-generative-deep-learning-by-david-foster-https-www-oreilly-com-library-view-generative-deep-learning-9781098134174-ch01-html" style="font-size: 80%;">Taxonomy of generative deep learning, "taken from Generative Deep Learning by David Foster":"https://www.oreilly.com/library/view/generative-deep-learning/9781098134174/ch01.html"</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs010.html#good-books-with-hands-on-material-and-codes" style="font-size: 80%;">Good books with hands-on material and codes</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs011.html#what-are-the-basic-machine-learning-ingredients" style="font-size: 80%;">What are the basic Machine Learning ingredients?</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs012.html#low-level-machine-learning-the-family-of-ordinary-least-squares-methods" style="font-size: 80%;">Low-level machine learning, the family of ordinary least squares methods</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs013.html#setting-up-the-equations" style="font-size: 80%;">Setting up the equations</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs014.html#the-objective-cost-loss-function" style="font-size: 80%;">The objective/cost/loss function</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs015.html#training-solution" style="font-size: 80%;">Training solution</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs016.html#selected-references" style="font-size: 80%;">Selected references</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs017.html#machine-learning-a-simple-perspective-on-the-interface-between-ml-and-physics" style="font-size: 80%;">Machine learning. A simple perspective on the interface between ML and Physics</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs018.html#ml-in-nuclear-physics-or-any-field-in-physics" style="font-size: 80%;">ML in Nuclear  Physics (or any field in physics)</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs019.html#phase-transitions-and-critical-phenomena" style="font-size: 80%;">Phase Transitions and Critical Phenomena</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs020.html#phase-transitions-definitions" style="font-size: 80%;">Phase Transitions: Definitions</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs021.html#order-parameter-and-symmetry-breaking" style="font-size: 80%;">Order Parameter and Symmetry Breaking</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs022.html#phase-transitions-overview" style="font-size: 80%;">Phase Transitions: Overview</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs023.html#phase-transitions-first-vs-second-order" style="font-size: 80%;">Phase Transitions: First vs Second Order</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs024.html#critical-phenomena-and-scaling" style="font-size: 80%;">Critical Phenomena and Scaling</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs025.html#2d-ising-model-definition" style="font-size: 80%;">2D Ising Model: Definition</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs026.html#2d-ising-model-critical-temperature" style="font-size: 80%;">2D Ising Model: Critical Temperature</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs027.html#q-state-potts-model-definition" style="font-size: 80%;">q-State Potts Model: Definition</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs028.html#2d-potts-model-phase-behavior" style="font-size: 80%;">2D Potts Model: Phase Behavior</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs029.html#monte-carlo-sampling-of-spin-models" style="font-size: 80%;">Monte Carlo Sampling of Spin Models</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs030.html#metropolis-algorithm" style="font-size: 80%;">Metropolis Algorithm</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs031.html#metropolis-algorithm-pseudo-code" style="font-size: 80%;">Metropolis Algorithm (Pseudo-code)</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs032.html#simple-code-to-generate-images" style="font-size: 80%;">Simple code to generate images</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs033.html#monte-carlo-data-for-ml" style="font-size: 80%;">Monte Carlo Data for ML</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs034.html#principal-component-analysis-pca-basics" style="font-size: 80%;">Principal Component Analysis (PCA) Basics</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs035.html#pca-for-phase-identification" style="font-size: 80%;">PCA for Phase Identification</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs036.html#pca-workflow-for-spin-data" style="font-size: 80%;">PCA Workflow for Spin Data</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs037.html#pca-example-ising-model" style="font-size: 80%;">PCA Example: Ising Model</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs038.html#pca-limitations" style="font-size: 80%;">PCA Limitations</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs039.html#convolutional-neural-networks-cnns" style="font-size: 80%;">Convolutional Neural Networks (CNNs)</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs040.html#cnn-for-phase-classification" style="font-size: 80%;">CNN for Phase Classification</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs041.html#example-cnn-architecture" style="font-size: 80%;">Example CNN Architecture</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs042.html#cnn-training-and-results" style="font-size: 80%;">CNN: Training and Results</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs043.html#cnn-interpretability" style="font-size: 80%;">CNN Interpretability</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs044.html#cnn-pytorch-code-example" style="font-size: 80%;">CNN (PyTorch) Code Example</a></li>
     <!-- navigation toc: --> <li><a href="#code-to-read-in-ising-data" style="font-size: 80%;">Code to read in Ising data</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs046.html#variational-autoencoders-vae-overview" style="font-size: 80%;">Variational Autoencoders (VAE) Overview</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs047.html#vae-for-spin-configurations" style="font-size: 80%;">VAE for Spin Configurations</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs048.html#vae-architecture-details" style="font-size: 80%;">VAE Architecture Details</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs049.html#vae-results-on-ising-model" style="font-size: 80%;">VAE Results on Ising Model</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs050.html#vae-generation-and-interpretation" style="font-size: 80%;">VAE: Generation and Interpretation</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs051.html#vae-pytorch-code-example" style="font-size: 80%;">VAE (PyTorch) Code Example</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs052.html#supervised-vs-unsupervised-methods" style="font-size: 80%;">Supervised vs Unsupervised Methods</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs053.html#method-interpretability-and-features" style="font-size: 80%;">Method Interpretability and Features</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs054.html#performance-and-use-cases" style="font-size: 80%;">Performance and Use Cases</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs055.html#summary-of-methods" style="font-size: 80%;">Summary of Methods</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs056.html#conclusions" style="font-size: 80%;">Conclusions</a></li>
     <!-- navigation toc: --> <li><a href="._lecturenotes-bs057.html#references" style="font-size: 80%;">References</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->
<div class="container">
<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->
<a name="part0045"></a>
<!-- !split -->
<h2 id="code-to-read-in-ising-data" class="anchor">Code to read in Ising data </h2>


<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;"><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;</span>
<span style="color: #BA2121; font-style: italic">Loads PNG spin images (ising_T2.0.png, …, ising_T2.5.png).</span>
<span style="color: #BA2121; font-style: italic">Labels them as:</span>
<span style="color: #BA2121; font-style: italic">0 if T &lt; 2.27 (below critical temperature)</span>
<span style="color: #BA2121; font-style: italic">1 if T \geq 2.27 (above critical temperature)</span>

<span style="color: #BA2121; font-style: italic">Defines a small CNN classifier.</span>
<span style="color: #BA2121; font-style: italic">Trains and evaluates the classifier.</span>
<span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">os</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">torch</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">torch.nn</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">nn</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">torch.optim</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">optim</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">torchvision</span> <span style="color: #008000; font-weight: bold">import</span> transforms
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">torch.utils.data</span> <span style="color: #008000; font-weight: bold">import</span> Dataset, DataLoader, random_split
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">PIL</span> <span style="color: #008000; font-weight: bold">import</span> Image
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>

<span style="color: #408080; font-style: italic"># Directory where Ising model images are stored</span>
image_dir <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;./&#39;</span>  <span style="color: #408080; font-style: italic"># adjust path if needed</span>
critical_temp <span style="color: #666666">=</span> <span style="color: #666666">2.27</span>

<span style="color: #408080; font-style: italic"># Custom Dataset</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">IsingDataset</span>(Dataset):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, root_dir, transform<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">None</span>):
        <span style="color: #008000">self</span><span style="color: #666666">.</span>root_dir <span style="color: #666666">=</span> root_dir
        <span style="color: #008000">self</span><span style="color: #666666">.</span>image_files <span style="color: #666666">=</span> <span style="color: #008000">sorted</span>([f <span style="color: #008000; font-weight: bold">for</span> f <span style="color: #AA22FF; font-weight: bold">in</span> os<span style="color: #666666">.</span>listdir(root_dir) <span style="color: #008000; font-weight: bold">if</span> f<span style="color: #666666">.</span>startswith(<span style="color: #BA2121">&quot;ising_T&quot;</span>) <span style="color: #AA22FF; font-weight: bold">and</span> f<span style="color: #666666">.</span>endswith(<span style="color: #BA2121">&quot;.png&quot;</span>)])
        <span style="color: #008000">self</span><span style="color: #666666">.</span>transform <span style="color: #666666">=</span> transform

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__len__</span>(<span style="color: #008000">self</span>):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">len</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>image_files)

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__getitem__</span>(<span style="color: #008000">self</span>, idx):
        file <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>image_files[idx]
        T <span style="color: #666666">=</span> <span style="color: #008000">float</span>(file<span style="color: #666666">.</span>split(<span style="color: #BA2121">&quot;T&quot;</span>)[<span style="color: #666666">1</span>]<span style="color: #666666">.</span>replace(<span style="color: #BA2121">&quot;.png&quot;</span>, <span style="color: #BA2121">&quot;&quot;</span>))
        label <span style="color: #666666">=</span> <span style="color: #666666">0</span> <span style="color: #008000; font-weight: bold">if</span> T <span style="color: #666666">&lt;</span> critical_temp <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">1</span>

        image <span style="color: #666666">=</span> Image<span style="color: #666666">.</span>open(os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>join(<span style="color: #008000">self</span><span style="color: #666666">.</span>root_dir, file))<span style="color: #666666">.</span>convert(<span style="color: #BA2121">&quot;L&quot;</span>)  <span style="color: #408080; font-style: italic"># grayscale</span>

        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>transform:
            image <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>transform(image)

        <span style="color: #008000; font-weight: bold">return</span> image, label

<span style="color: #408080; font-style: italic"># Transforms</span>
transform <span style="color: #666666">=</span> transforms<span style="color: #666666">.</span>Compose([
    transforms<span style="color: #666666">.</span>Resize((<span style="color: #666666">50</span>, <span style="color: #666666">50</span>)),
    transforms<span style="color: #666666">.</span>ToTensor(),  <span style="color: #408080; font-style: italic"># shape (1, H, W), values in [0,1]</span>
])

<span style="color: #408080; font-style: italic"># Dataset and Dataloader</span>
dataset <span style="color: #666666">=</span> IsingDataset(image_dir, transform<span style="color: #666666">=</span>transform)
train_size <span style="color: #666666">=</span> <span style="color: #008000">int</span>(<span style="color: #666666">0.8</span> <span style="color: #666666">*</span> <span style="color: #008000">len</span>(dataset))
test_size <span style="color: #666666">=</span> <span style="color: #008000">len</span>(dataset) <span style="color: #666666">-</span> train_size
train_dataset, test_dataset <span style="color: #666666">=</span> random_split(dataset, [train_size, test_size])

train_loader <span style="color: #666666">=</span> DataLoader(train_dataset, batch_size<span style="color: #666666">=8</span>, shuffle<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>)
test_loader <span style="color: #666666">=</span> DataLoader(test_dataset, batch_size<span style="color: #666666">=8</span>, shuffle<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>)

<span style="color: #408080; font-style: italic"># CNN Model</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">CNN</span>(nn<span style="color: #666666">.</span>Module):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>):
        <span style="color: #008000">super</span>(CNN, <span style="color: #008000">self</span>)<span style="color: #666666">.</span><span style="color: #0000FF">__init__</span>()
        <span style="color: #008000">self</span><span style="color: #666666">.</span>net <span style="color: #666666">=</span> nn<span style="color: #666666">.</span>Sequential(
            nn<span style="color: #666666">.</span>Conv2d(<span style="color: #666666">1</span>, <span style="color: #666666">16</span>, <span style="color: #666666">3</span>, padding<span style="color: #666666">=1</span>),
            nn<span style="color: #666666">.</span>ReLU(),
            nn<span style="color: #666666">.</span>MaxPool2d(<span style="color: #666666">2</span>),
            nn<span style="color: #666666">.</span>Conv2d(<span style="color: #666666">16</span>, <span style="color: #666666">32</span>, <span style="color: #666666">3</span>, padding<span style="color: #666666">=1</span>),
            nn<span style="color: #666666">.</span>ReLU(),
            nn<span style="color: #666666">.</span>MaxPool2d(<span style="color: #666666">2</span>),
            nn<span style="color: #666666">.</span>Flatten(),
            nn<span style="color: #666666">.</span>Linear(<span style="color: #666666">32</span> <span style="color: #666666">*</span> <span style="color: #666666">12</span> <span style="color: #666666">*</span> <span style="color: #666666">12</span>, <span style="color: #666666">64</span>),
            nn<span style="color: #666666">.</span>ReLU(),
            nn<span style="color: #666666">.</span>Linear(<span style="color: #666666">64</span>, <span style="color: #666666">2</span>)
        )

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">forward</span>(<span style="color: #008000">self</span>, x):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>net(x)

<span style="color: #408080; font-style: italic"># Instantiate and train</span>
device <span style="color: #666666">=</span> torch<span style="color: #666666">.</span>device(<span style="color: #BA2121">&quot;cuda&quot;</span> <span style="color: #008000; font-weight: bold">if</span> torch<span style="color: #666666">.</span>cuda<span style="color: #666666">.</span>is_available() <span style="color: #008000; font-weight: bold">else</span> <span style="color: #BA2121">&quot;cpu&quot;</span>)
model <span style="color: #666666">=</span> CNN()<span style="color: #666666">.</span>to(device)
optimizer <span style="color: #666666">=</span> optim<span style="color: #666666">.</span>Adam(model<span style="color: #666666">.</span>parameters(), lr<span style="color: #666666">=0.001</span>)
loss_fn <span style="color: #666666">=</span> nn<span style="color: #666666">.</span>CrossEntropyLoss()

<span style="color: #408080; font-style: italic"># Training loop</span>
num_epochs <span style="color: #666666">=</span> <span style="color: #666666">10</span>
<span style="color: #008000; font-weight: bold">for</span> epoch <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(num_epochs):
    model<span style="color: #666666">.</span>train()
    total_loss <span style="color: #666666">=</span> <span style="color: #666666">0</span>
    <span style="color: #008000; font-weight: bold">for</span> images, labels <span style="color: #AA22FF; font-weight: bold">in</span> train_loader:
        images, labels <span style="color: #666666">=</span> images<span style="color: #666666">.</span>to(device), labels<span style="color: #666666">.</span>to(device)
        outputs <span style="color: #666666">=</span> model(images)
        loss <span style="color: #666666">=</span> loss_fn(outputs, labels)

        optimizer<span style="color: #666666">.</span>zero_grad()
        loss<span style="color: #666666">.</span>backward()
        optimizer<span style="color: #666666">.</span>step()
        total_loss <span style="color: #666666">+=</span> loss<span style="color: #666666">.</span>item()

    <span style="color: #008000">print</span>(<span style="color: #BA2121">f&quot;Epoch </span><span style="color: #BB6688; font-weight: bold">{</span>epoch<span style="color: #666666">+1</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">/</span><span style="color: #BB6688; font-weight: bold">{</span>num_epochs<span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">, Loss: </span><span style="color: #BB6688; font-weight: bold">{</span>total_loss<span style="color: #666666">/</span><span style="color: #008000">len</span>(train_loader)<span style="color: #BB6688; font-weight: bold">:</span><span style="color: #BA2121">.4f</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>)

<span style="color: #408080; font-style: italic"># Evaluation</span>
model<span style="color: #666666">.</span>eval()
correct <span style="color: #666666">=</span> <span style="color: #666666">0</span>
total <span style="color: #666666">=</span> <span style="color: #666666">0</span>
<span style="color: #008000; font-weight: bold">with</span> torch<span style="color: #666666">.</span>no_grad():
    <span style="color: #008000; font-weight: bold">for</span> images, labels <span style="color: #AA22FF; font-weight: bold">in</span> test_loader:
        images, labels <span style="color: #666666">=</span> images<span style="color: #666666">.</span>to(device), labels<span style="color: #666666">.</span>to(device)
        outputs <span style="color: #666666">=</span> model(images)
        _, predicted <span style="color: #666666">=</span> torch<span style="color: #666666">.</span>max(outputs<span style="color: #666666">.</span>data, <span style="color: #666666">1</span>)
        total <span style="color: #666666">+=</span> labels<span style="color: #666666">.</span>size(<span style="color: #666666">0</span>)
        correct <span style="color: #666666">+=</span> (predicted <span style="color: #666666">==</span> labels)<span style="color: #666666">.</span>sum()<span style="color: #666666">.</span>item()

<span style="color: #008000">print</span>(<span style="color: #BA2121">f&quot;Test Accuracy: </span><span style="color: #BB6688; font-weight: bold">{</span><span style="color: #666666">100</span> <span style="color: #666666">*</span> correct <span style="color: #666666">/</span> total<span style="color: #BB6688; font-weight: bold">:</span><span style="color: #BA2121">.2f</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">%&quot;</span>)
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>


<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pagination">
<li><a href="._lecturenotes-bs044.html">&laquo;</a></li>
  <li><a href="._lecturenotes-bs000.html">1</a></li>
  <li><a href="">...</a></li>
  <li><a href="._lecturenotes-bs037.html">38</a></li>
  <li><a href="._lecturenotes-bs038.html">39</a></li>
  <li><a href="._lecturenotes-bs039.html">40</a></li>
  <li><a href="._lecturenotes-bs040.html">41</a></li>
  <li><a href="._lecturenotes-bs041.html">42</a></li>
  <li><a href="._lecturenotes-bs042.html">43</a></li>
  <li><a href="._lecturenotes-bs043.html">44</a></li>
  <li><a href="._lecturenotes-bs044.html">45</a></li>
  <li class="active"><a href="._lecturenotes-bs045.html">46</a></li>
  <li><a href="._lecturenotes-bs046.html">47</a></li>
  <li><a href="._lecturenotes-bs047.html">48</a></li>
  <li><a href="._lecturenotes-bs048.html">49</a></li>
  <li><a href="._lecturenotes-bs049.html">50</a></li>
  <li><a href="._lecturenotes-bs050.html">51</a></li>
  <li><a href="._lecturenotes-bs051.html">52</a></li>
  <li><a href="._lecturenotes-bs052.html">53</a></li>
  <li><a href="._lecturenotes-bs053.html">54</a></li>
  <li><a href="._lecturenotes-bs054.html">55</a></li>
  <li><a href="">...</a></li>
  <li><a href="._lecturenotes-bs057.html">58</a></li>
  <li><a href="._lecturenotes-bs046.html">&raquo;</a></li>
</ul>
<!-- ------------------- end of main content --------------- -->
</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<!-- Bootstrap footer
<footer>
<a href="https://..."><img width="250" align=right src="https://..."></a>
</footer>
-->
</body>
</html>

